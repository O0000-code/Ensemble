# Claude.md 管理功能 - 任务理解文档

## 一、任务背景

Ensemble 是一款 macOS 桌面应用，用于管理 Claude Code 的 Skill 和 MCP。目前 Claude Code 的"三件套"包括：
1. **MCP (Model Context Protocol)** - 已支持
2. **Skill** - 已支持
3. **Claude.md** - **待添加支持**

## 二、核心需求

### 2.1 添加 Claude.md 管理功能

需要研究并实现：
- Claude.md 的所有配置方式（用户级、项目级等）
- 本地已有的 Claude.md 文件位置和格式
- 如何将 Claude.md 集成到 Scene 的分发机制中

### 2.2 处理插件安装的 Skill 和 MCP

用户明确提出的处理策略：

1. **存储形式调研**：插件安装的 Skill/MCP 是否与普通形式存储一致（JSON 配置/源文件）

2. **导入功能**：
   - 如果存储形式一致，可以做"导入"功能
   - 导入后**不修改**插件原始配置
   - 用户需要自己用 Claude Code 命令删除插件

3. **导入后的行为**：
   - 不删除也可以，会有两份
   - 导入只是为了分类和查看
   - **不能**把这些全局的插件加入到 Scene 中（因为它们在任何项目都会加载，再复制一份会重复）

4. **导入列表过滤**：
   - 导入后，导入弹框中不应再显示这些已导入的项
   - 判断方式**不是删除**，而是需要标记"已导入"
   - 这与现有逻辑不同（现有通过删除 User 级配置来不显示）

## 三、约束条件

1. **不影响现有功能和样式** - 所有修改必须保持现有功能完整
2. **使用 Git Worktree** - 多 Agent 并行工作时使用 worktree 隔离
3. **手动验证** - 完成后需要 `npm run tauri dev` 运行验证
4. **插件不直接修改** - 插件属于 Claude Code 官方工具，选择不直接编辑

## 四、技术要点

### 4.1 Claude.md 可能的配置层级

需要调研确认：
- 用户级：`~/.claude/CLAUDE.md`
- 项目级：`项目目录/CLAUDE.md` 或 `项目目录/.claude/CLAUDE.md`
- 其他可能的层级

### 4.2 插件安装的资源处理

需要调研确认：
- 插件安装的 Skill 存储位置
- 插件安装的 MCP 配置位置
- 如何区分插件安装 vs 手动安装

### 4.3 "已导入"标记机制

需要设计：
- 如何标记一个 Skill/MCP 已被导入（不删除原配置）
- 标记数据存储位置（可能在 `~/.ensemble/data.json`）
- 导入列表的过滤逻辑

## 五、执行策略

### 阶段一：深度研究（Multiple SubAgent）

1. **研究维度规划 SubAgent** - 思考需要从哪些方面研究
2. **Claude.md 研究 SubAgent** - 使用 claude-code-guide 研究所有配置方式
3. **插件系统研究 SubAgent** - 研究插件安装的存储形式
4. **本地文件分析 SubAgent** - 分析本地 Claude 目录结构

### 阶段二：方案设计

基于研究结果，设计：
- 数据模型扩展
- UI 页面设计（参考设计稿或扩展）
- 配置同步机制

### 阶段三：实施开发

使用 Git Worktree 进行开发，确保不影响主分支

### 阶段四：验证测试

运行应用，手动验证效果

## 六、待确认问题

1. Claude.md 是否有设计稿？如果没有，需要设计新页面
2. 插件安装的资源如何识别和区分
3. Scene 分发 Claude.md 的具体机制

## 七、质量标准

1. 与设计稿 1:1 匹配（如有）
2. 所有交互符合预期
3. 代码质量高、类型完整
4. 不影响现有功能
5. 无 console 错误和警告

---

*文档版本: 1.0*
*创建时间: 2026-02-04*
