# Category & Tag 内联编辑功能 - 需求理解文档

## 一、任务背景

Ensemble 是一款 macOS 桌面应用，用于管理 Claude Code 的 Skills 和 MCP Servers。项目基于 Tauri 2.x + React 18 + TypeScript + Tailwind CSS 技术栈开发。

当前项目开发已基本完成，需要完善侧边栏中 **Categories（类别）** 和 **Tags（标签）** 的新增和重命名功能。

## 二、当前问题

1. **缺少新增按钮**：侧边栏的 Categories 和 Tags 区域没有 `+` 按钮来新增项目
2. **重命名功能失效**：右键菜单虽然会出现重命名弹框，但点击后没有任何反应

## 三、设计稿参考

设计稿文件：`/Users/bo/Downloads/MCP 管理.pen`

本次新增的 4 个侧边栏状态画面：

| 画面名称 | 节点 ID | 说明 |
|---------|---------|------|
| `Ensemble - Add Category (Inline)` | `LxRtJ` | 新增类别状态 |
| `Ensemble - Add Tag (Inline)` | `r3UEu` | 新增标签状态 |
| `Ensemble - Edit Category (Inline)` | `JgsTm` | 编辑（重命名）类别状态 |
| `Ensemble - Edit Tag (Inline)` | `5jJVC` | 编辑（重命名）标签状态 |

## 四、功能需求详解

### 4.1 新增状态（点击 `+` 按钮后）

**核心原则**：新增项的外观与「已选中项」完全一致，只是内容为占位文字。不需要任何额外的边框、光标线等装饰。

#### 新增类别样式（参考节点 `btEsy`）
- 位置：在类别列表底部追加一行
- 容器：`#F4F4F5` 灰底，`cornerRadius: 6`，`height: 32`，`padding: [0, 10]`，**无边框**
- 圆点：`8×8`，`cornerRadius: 4`，填充 `#A1A1AA`（默认灰色）
- 占位文字：`"Category name..."`，颜色 `#A1A1AA`，`Inter 13px normal`

#### 新增标签样式（参考节点 `lvMrx`）
- 位置：在标签网格末尾追加一个标签胶囊
- 容器：`#F4F4F5` 灰底，`cornerRadius: 4`，`padding: [5, 10]`，边框 `#E5E5E5 1px inside`
- 占位文字：`"Tag name..."`，颜色 `#A1A1AA`，`Inter 11px 500`

### 4.2 编辑（重命名）状态

**核心原则**：行/胶囊整体保持与「已选中项」相同的 `#F4F4F5` 灰底，文字使用 macOS 原生的蓝色全选高亮。

#### 编辑类别样式（参考节点 `kBOoT`）
- 容器：`#F4F4F5` 灰底，`cornerRadius: 6`，`height: 32`，**无边框**
- 圆点：保持该类别原有颜色不变
- 计数文字（如 `(23)`）：隐藏
- **文字全选高亮**（参考节点 `GBYuM`）：
  - 选中框：`#0063E1` 蓝底，`cornerRadius: 2`，`padding: [1, 2]`
  - 文字：白色 `#FFFFFF`

#### 编辑标签样式（参考节点 `U8bTb`）
- 容器：`#F4F4F5` 灰底，`cornerRadius: 4`，`padding: [5, 10]`，边框 `#E5E5E5 1px inside`
- **文字全选高亮**（参考节点 `MWCJV`）：
  - 选中框：`#0063E1` 蓝底，`cornerRadius: 2`，`padding: [1, 2]`
  - 文字：白色 `#FFFFFF`

### 4.3 交互行为

1. **新增流程**：
   - 用户点击 `+` 按钮
   - 列表/网格末尾出现输入项
   - 自动聚焦到输入框
   - 输入名称
   - 按 Enter 确认创建 / 按 Esc 或点击外部取消

2. **编辑流程**：
   - 用户双击已有项（或通过右键菜单选择重命名）
   - 该项进入编辑态，文字被全选高亮
   - 直接输入即可替换原有文字
   - 按 Enter 确认修改 / 按 Esc 取消

3. **互斥规则**：
   - 新增和编辑是互斥状态
   - 同一时刻只能有一个项处于输入/编辑态
   - 当进入新的编辑/新增状态时，之前的状态应自动取消

## 五、技术实现要点

### 5.1 状态管理
- 需要在 store 中添加编辑状态相关的字段
- 可能涉及的 store：`categoriesStore`、`tagsStore` 或统一的 `sidebarStore`

### 5.2 组件修改
- 侧边栏组件（Sidebar）：添加 `+` 按钮
- 类别项组件：支持普通态、选中态、编辑态
- 标签项组件：支持普通态、选中态、编辑态

### 5.3 关键样式
- 全选高亮效果：`#0063E1` 蓝底 + 白色文字
- 输入框样式：需要隐藏原生输入框边框，保持与设计一致

### 5.4 已有右键菜单
- 根据之前的记录，已有右键菜单但点击无反应
- 需要检查右键菜单的事件处理逻辑

## 六、质量要求

1. **不影响现有功能**：修改不能破坏任何已有的功能和样式
2. **视觉还原**：与设计稿 1:1 匹配
3. **交互流畅**：新增/编辑/取消操作响应及时
4. **代码质量**：类型完整、结构清晰

## 七、需要调研的内容

1. **设计稿详情**：通过 pencil MCP 工具获取 4 个新设计稿画面的详细结构
2. **现有代码**：
   - 侧边栏组件结构和实现
   - 类别/标签相关的 store
   - 右键菜单的实现
   - 已有的类别/标签渲染逻辑

## 八、预期交付物

1. 完善的侧边栏 Categories 区域：
   - `+` 按钮
   - 新增类别的内联输入功能
   - 重命名类别的内联编辑功能（修复右键菜单）
   - 双击进入编辑模式

2. 完善的侧边栏 Tags 区域：
   - `+` 按钮
   - 新增标签的内联输入功能
   - 重命名标签的内联编辑功能
   - 双击进入编辑模式

3. 相关文档更新
